(window.webpackJsonp=window.webpackJsonp||[]).push([[55],{877:function(t,s,a){"use strict";a.r(s);var n=a(75),e=Object(n.a)({},(function(){var t=this,s=t._self._c;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("h1",{attrs:{id:"todo-构建-部署"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#todo-构建-部署"}},[t._v("#")]),t._v(" TODO:构建&部署")]),t._v(" "),s("h2",{attrs:{id:"构建"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#构建"}},[t._v("#")]),t._v(" 构建")]),t._v(" "),s("p",[t._v("项目开发完成之后，执行以下命令进行构建")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[t._v("yarn")]),t._v(" build\n")])])]),s("p",[t._v("构建打包成功之后，会在根目录生成 dist 文件夹，里面就是构建打包好的文件")]),t._v(" "),s("h3",{attrs:{id:"旧版浏览器兼容"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#旧版浏览器兼容"}},[t._v("#")]),t._v(" 旧版浏览器兼容")]),t._v(" "),s("p",[t._v("在 "),s("strong",[t._v(".env.prod")]),t._v(" 内")]),t._v(" "),s("p",[t._v("设置 "),s("code",[t._v("VITE_LEGACY=true")]),t._v(" 即可打包出兼容旧版浏览器的代码")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[t._v("VITE_LEGACY "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),t._v("\n")])])]),s("h3",{attrs:{id:"预览"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#预览"}},[t._v("#")]),t._v(" 预览")]),t._v(" "),s("p",[t._v("发布之前可以在本地进行预览，有多种方式，这里介绍两种")]),t._v(" "),s("p",[s("strong",[t._v("不能直接打开构建后的 html 文件")])]),t._v(" "),s("ul",[s("li",[t._v("使用项目自定的命令进行预览(推荐)")])]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 先打包在进行预览")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("yarn")]),t._v(" preview\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 直接预览本地 dist 文件目录")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("yarn")]),t._v(" preview:dist\n")])])]),s("ul",[s("li",[t._v("本地服务器预览(通过 live-server)")])]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 1.全局安装live-server")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("yarn")]),t._v(" global "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("add")]),t._v(" live-server\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 2. 进入打包的后目录")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("cd")]),t._v(" ./dist\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 本地预览，默认端口8080")]),t._v("\nlive-server\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 指定端口")]),t._v("\nlive-server "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("--port")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("9000")]),t._v("\n")])])]),s("h3",{attrs:{id:"分析构建文件体积"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#分析构建文件体积"}},[t._v("#")]),t._v(" 分析构建文件体积")]),t._v(" "),s("p",[t._v("如果你的构建文件很大，可以通过项目内置 "),s("a",{attrs:{href:"https://github.com/doesdev/rollup-plugin-analyzer",target:"_blank",rel:"noopener noreferrer"}},[t._v("rollup-plugin-analyzer"),s("OutboundLink")],1),t._v(" 插件进行代码体积分析，从而优化你的代码。")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[t._v("yarn")]),t._v(" report\n\n")])])]),s("p",[t._v("运行之后，在自动打开的页面可以看到具体的体积分布，以分析哪些依赖有问题。")]),t._v(" "),s("div",{staticClass:"custom-block tip"},[s("p",{staticClass:"custom-block-title"},[t._v("TIP")]),t._v(" "),s("p",[t._v("左上角可以切换 显示 gzip 或者 brotli")])]),t._v(" "),s("p",[s("img",{attrs:{src:"/images/report.png",alt:""}})]),t._v(" "),s("h2",{attrs:{id:"压缩"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#压缩"}},[t._v("#")]),t._v(" 压缩")]),t._v(" "),s("h3",{attrs:{id:"开启-gzip-压缩"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#开启-gzip-压缩"}},[t._v("#")]),t._v(" 开启 gzip 压缩")]),t._v(" "),s("p",[t._v("开启 gzip，并配合 nginx 的 "),s("code",[t._v("gzip_static")]),t._v(" 功能可以大大加快页面访问速度")]),t._v(" "),s("div",{staticClass:"custom-block tip"},[s("p",{staticClass:"custom-block-title"},[t._v("TIP")]),t._v(" "),s("p",[t._v("只需开启 "),s("code",[t._v("VITE_BUILD_COMPRESS='gzip'")]),t._v(" 即可在打包的同时生成 .gz 文件")])]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 根据自己路径来配置更改")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 例如部署在nginx /next/路径下  则VITE_PUBLIC_PATH=/next/")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("VITE_PUBLIC_PATH")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("/\n")])])]),s("h3",{attrs:{id:"开启-brotli-压缩"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#开启-brotli-压缩"}},[t._v("#")]),t._v(" 开启 brotli 压缩")]),t._v(" "),s("p",[t._v("brotli 是比 gzip 压缩率更高的算法，可以与 gzip 共存不会冲突，需要 nginx 安装指定模块并开启即可。")]),t._v(" "),s("div",{staticClass:"custom-block tip"},[s("p",{staticClass:"custom-block-title"},[t._v("TIP")]),t._v(" "),s("p",[t._v("只需开启 "),s("code",[t._v("VITE_BUILD_COMPRESS='brotli'")]),t._v(" 即可在打包的同时生成 .br 文件")])]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 根据自己路径来配置更改")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 例如部署在nginx /next/路径下  则VITE_PUBLIC_PATH=/next/")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("VITE_PUBLIC_PATH")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("/\n")])])]),s("h3",{attrs:{id:"同时开启-gzip-与-brotli"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#同时开启-gzip-与-brotli"}},[t._v("#")]),t._v(" 同时开启 gzip 与 brotli")]),t._v(" "),s("p",[t._v("只需开启 "),s("code",[t._v("VITE_BUILD_COMPRESS='brotli,gzip'")]),t._v(" 即可在打包的同时生成 "),s("code",[t._v(".gz")]),t._v(" 和 "),s("code",[t._v(".br")]),t._v(" 文件。")]),t._v(" "),s("h3",{attrs:{id:"gzip-与-brotli-在-nginx-内的配置"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#gzip-与-brotli-在-nginx-内的配置"}},[t._v("#")]),t._v(" gzip 与 brotli 在 nginx 内的配置")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[t._v("http "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 开启gzip")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("gzip")]),t._v(" on"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 开启gzip_static")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# gzip_static 开启后可能会报错，需要安装相应的模块, 具体安装方式可以自行查询")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 只有这个开启，vue文件打包的.gz文件才会有效果，否则不需要开启gzip进行打包")]),t._v("\n  gzip_static on"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  gzip_proxied any"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  gzip_min_length 1k"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  gzip_buffers "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("4")]),t._v(" 16k"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#如果nginx中使用了多层代理 必须设置这个才可以开启gzip。")]),t._v("\n  gzip_http_version "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1.0")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  gzip_comp_level "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  gzip_types text/plain application/javascript application/x-javascript text/css application/xml text/javascript application/x-httpd-php image/jpeg image/gif image/png"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  gzip_vary off"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  gzip_disable "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"MSIE [1-6]\\."')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 开启 brotli压缩")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 需要安装对应的nginx模块,具体安装方式可以自行查询")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 可以与gzip共存不会冲突")]),t._v("\n  brotli on"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  brotli_comp_level "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("6")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  brotli_buffers "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("16")]),t._v(" 8k"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  brotli_min_length "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("20")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  brotli_types text/plain text/css application/json application/x-javascript text/xml application/xml application/xml+rss text/javascript application/javascript image/svg+xml"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("h2",{attrs:{id:"部署"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#部署"}},[t._v("#")]),t._v(" 部署")]),t._v(" "),s("div",{staticClass:"custom-block danger"},[s("p",{staticClass:"custom-block-title"},[t._v("注意")]),t._v(" "),s("p",[t._v("项目默认是在生产环境开启 Mock，这样做非常不好，只是为了演示环境有数据，不建议在生产环境使用 Mock，而应该使用真实的后台接口，并将 Mock 关闭。")])]),t._v(" "),s("h3",{attrs:{id:"发布"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#发布"}},[t._v("#")]),t._v(" 发布")]),t._v(" "),s("p",[t._v("简单的部署只需要将最终生成的静态文件，dist 文件夹的静态文件发布到你的 cdn 或者静态服务器即可，需要注意的是其中的 index.html 通常会是你后台服务的入口页面，在确定了 js 和 css 的静态之后可能需要改变页面的引入路径。")]),t._v(" "),s("p",[t._v("例如上传到 nginx")]),t._v(" "),s("p",[s("code",[t._v("/srv/www/project/index.html")])]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# nginx配置")]),t._v("\nlocation / "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 不缓存html，防止程序更新后缓存继续生效")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$request_filename")]),t._v(" ~* .*"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("."),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("?:htm"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("html"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("$"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    add_header Cache-Control "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"private, no-store, no-cache, must-revalidate, proxy-revalidate"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    access_log on"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 这里是vue打包文件dist内的文件的存放路径")]),t._v("\n  root   /srv/www/project/"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  index  index.html index.htm"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n")])])]),s("p",[s("strong",[t._v("部署时可能会发现资源路径不对，只需要修改"),s("code",[t._v(".env.prod")]),t._v("文件即可。")])]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 根据自己路径来配置更改")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 注意需要以 / 开头和结尾")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("VITE_PUBLIC_PATH")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("/\n"),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("VITE_PUBLIC_PATH")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("/xxx/\n")])])]),s("h3",{attrs:{id:"前端路由与服务端的结合"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#前端路由与服务端的结合"}},[t._v("#")]),t._v(" 前端路由与服务端的结合")]),t._v(" "),s("p",[t._v("项目前端路由使用的是 vue-router，所以你可以选择两种方式：history 和 hash。")]),t._v(" "),s("ul",[s("li",[s("strong",[t._v("hash")]),t._v(" 默认会在 url 后面拼接"),s("code",[t._v("#")])]),t._v(" "),s("li",[s("strong",[t._v("history")]),t._v(" 则不会，不过 "),s("code",[t._v("history")]),t._v(" 需要服务器配合")])]),t._v(" "),s("p",[t._v("可在 src/router/index.ts 内进行 mode 修改")]),t._v(" "),s("div",{staticClass:"language-ts extra-class"},[s("pre",{pre:!0,attrs:{class:"language-ts"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  createRouter"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  createWebHashHistory"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  createWebHistory"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"vue-router"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("createRouter")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  history"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("createWebHashHistory")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// or")]),t._v("\n  history"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("createWebHistory")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),s("h3",{attrs:{id:"history-路由模式下服务端配置"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#history-路由模式下服务端配置"}},[t._v("#")]),t._v(" history 路由模式下服务端配置")]),t._v(" "),s("p",[t._v("开启 history 模式需要服务器配置，更多的服务器配置详情可以看 "),s("a",{attrs:{href:"https://next.router.vuejs.org/guide/essentials/history-mode.html#html5-mode",target:"_blank",rel:"noopener noreferrer"}},[t._v("history-mode"),s("OutboundLink")],1)]),t._v(" "),s("p",[t._v("这里以 nginx 配置为例")]),t._v(" "),s("p",[s("strong",[t._v("部署到根目录")])]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[t._v("server "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  listen "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("80")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  location / "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 用于配合 History 使用")]),t._v("\n    try_files "),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$uri")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$uri")]),t._v("/ /index.html"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("p",[s("strong",[t._v("部署到非根目录")])]),t._v(" "),s("ol",[s("li",[t._v("首先需要在打包的时候更改配置")])]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 在.env.prod内，配置子目录路径")]),t._v("\nVITE_PUBLIC_PATH "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" /sub/\n")])])]),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[t._v("server "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    listen       "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("80")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    server_name  localhost"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    location /sub/ "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 这里是vue打包文件dist内的文件的存放路径")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("alias")]),t._v("   /srv/www/project/"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n      index index.html index.htm"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n      try_files "),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$uri")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$uri")]),t._v("/ /sub/index.html"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("h3",{attrs:{id:"使用-nginx-处理跨域"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#使用-nginx-处理跨域"}},[t._v("#")]),t._v(" 使用 nginx 处理跨域")]),t._v(" "),s("p",[t._v("使用 nginx 处理项目部署后的跨域问题")]),t._v(" "),s("ol",[s("li",[t._v("配置前端项目接口地址")])]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 在.env.prod内，配置接口地址")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("VITE_GLOB_API_URL")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("/api\n")])])]),s("ol",{attrs:{start:"2"}},[s("li",[t._v("在 nginx 配置请求转发到后台")])]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[t._v("server "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  listen       "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("8080")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  server_name  localhost"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 接口代理，用于解决跨域问题")]),t._v("\n  location /api "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    proxy_set_header Host "),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$host")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    proxy_set_header X-Real-IP "),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$remote_addr")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    proxy_set_header X-Forwarded-For "),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$proxy_add_x_forwarded_for")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 后台接口地址")]),t._v("\n    proxy_pass http://110.110.1.1:8080/api"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    proxy_redirect default"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    add_header Access-Control-Allow-Origin *"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    add_header Access-Control-Allow-Headers X-Requested-With"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    add_header Access-Control-Allow-Methods GET,POST,OPTIONS"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])])])}),[],!1,null,null,null);s.default=e.exports}}]);